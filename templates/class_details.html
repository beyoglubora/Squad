{% extends 'base.html' %}


{# Include Bootstrap 4 and jQuery #}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>

{# Django Tempus Dominus assets are included in `{{ form.media }}` #}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">

{% block content %}
    {% include 'navbar.html' %}
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css">

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css">
    <link rel="stylesheet" href="/static/css/assign_main_instructor.css">

    {{ form.media }}
    <style>
        body{
            background-color: whitesmoke;
        }

        #underline{
            margin-top: 0;
        }

        #class-title{
            display: inline-block;
            font-size: 64px;
            color: lightskyblue;
            font-family: 'Montserrat', sans-serif;
            margin-bottom: 20px;
        }

        #banner-card{
            background-color: white;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            padding-top: 3px;
            padding-left: 10px;
            padding-bottom: 15px;
            margin-bottom: 3%;
        }

        #wrapper{
            display: inline-block;
            margin-top: 10px;
            margin-left: 270px;
            width: 80%;
        }

        #enroll-class-container{
            width:100%;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            background-color: dodgerblue;
            padding-top:10px;
            padding-bottom: 10px;
            margin-top:-10px;
            margin-bottom: 20px;
            padding-right: 50px;
        }

        #enroll-class-container:hover{
            opacity: .7;
        }

        #enroll-class-text{
            color: white;
            font-family: 'Montserrat', sans-serif;
        }

        #create-group-container{
            width:100%;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            background-color: darkgreen;
            padding-top:10px;
            padding-bottom: 10px;
            margin-top:-10px;
            margin-bottom: 20px;
            padding-right: 50px;
        }

        #create-group-container:hover{
            opacity: .7;
        }

        #create-group-container-text{
            color: white;
            font-family: 'Montserrat', sans-serif;
        }

        #big-group-button{
            width:100%;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            background-color: dodgerblue;
            padding-top:10px;
            padding-bottom: 10px;
            margin-top:-10px;
            margin-bottom: 20px;
            padding-right: 50px;
        }

        #big-group-button:hover{
            opacity: .7;
        }

        #big-group-button-text{
            color: white;
            font-family: 'Montserrat', sans-serif;
        }
        #students-button{
            font-size: 40px;
            border: none;
            background: none;
            color: gray;
            margin-left: 2.5%;
            margin-right: 2.5%;
            margin-bottom: 3%;
        }
        #students-button:hover{
            color: lightskyblue;
        }
        #students-button:focus{
            outline:none;
        }
        #groups-button{
            font-size: 40px;
            border: none;
            background: none;
            color: gray;
            margin-left: 2.5%;
            margin-right: 2.5%;
            margin-bottom: 3%;
        }
        #groups-button:hover{
            color: lightskyblue;
        }
        #groups-button:focus{
            outline: none;
        }

        #discussion-button{
            font-size: 40px;
            border: none;
            background: none;
            color: gray;
            margin-left: 2.5%;
            margin-right: 2.5%;
            margin-bottom: 3%;
        }
        #discussion-button:hover{
            color: lightskyblue;
        }
        #discussion-button:focus {
            outline: none;
        }

        #assignments-button{
            font-size: 40px;
            border: none;
            background: none;
            color: gray;
            margin-left: 2.5%;
            margin-right: 2.5%;
            margin-bottom: 3%;
        }
        #assignments-button:hover{
            color: lightskyblue;
        }
        #assignments-button:focus {
            outline: none;
        }

        .student-container{
            background-color: white;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            margin-bottom: 5%;
            padding-left: 10px;
            padding-top:15px;
            padding-right: 10px;
            display: flex;
            padding-bottom: 10px;
        }
        .profile-photo{
            height: 100px;
            width: 100px;
            border-radius: 50%;
        }
        #instructor-name{
            margin-top: -70px;
            font-size: 30px;
            margin-left: 10px;
            color: gray;
        }
        .student-name{
            font-family: 'Montserrat', sans-serif;
            color: lightskyblue;
            font-size: 30px;
        }
        #group-roster{
            display: none;
        }
        #student-roster{
            display: none;
        }
        #assignments-roster{
            display: none;
        }
        #discussion-roster{
            display: none;
        }
        .group-container{
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            width: 500px;
            min-height: 300px;
            margin-bottom: 5%;
            padding-left: 30px;
            padding-right: 30px;
            padding-top:90px;
            display: inline-block;
            margin-right: 5%;
            text-align: center;
            background: none;
            border: none;
            word-wrap: break-word;
            background-color: white;
        }
        .group-name{
            font-family: 'Montserrat', sans-serif;
            color: lightskyblue;
            font-size: 30px;
            margin-top: 50px;
        }
        #description{
            color: gray;
            font-family: 'Montserrat', sans-serif;
            word-wrap: break-word;
        }
        #skills{
            color: gray;
            font-family: 'Montserrat', sans-serif;
        }
        .enroll-modal-content{
            position: absolute;
            background-color: white;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            height: 85%;
            width: 60%;
            margin: .5% auto;
            top:0;
	        bottom: 0;
	        left: 0;
	        right: 0;
            min-width: 850px;
            min-height: 590px;
        }
        #enroll-modal-body{
            margin: 5% 5% 5% 5%;
        }
        #enroll-class-banner{
            width:100%;
            height:20%;
            background-color: lightskyblue;
            text-align: center;
            padding-top: 20px;
        }
        #banner-enroll-class-text{
            font-family: 'Montserrat', sans-serif;
            color: white;
        }

        #enroll-class-description{
            border: 2px solid lightskyblue;
            height: 20%;
            width: 100%;
            text-indent: 10px;
            margin: 0 auto;
            resize: none;
        }
        #enroll-class-button{
            background-color: lightskyblue;
            height: 40px;
            width: 100px;
            color: white;
            border: none;
            margin-left: 40%;
        }
        .skill{
            border: 2px solid lightskyblue;
            outline: none;
        }
        .list-item{
            height: 40px;
            margin-left: 20px;
            display: inline-block;
        }
        .unordered-list{
            list-style: none;
            margin-top:15px;
        }
        .delete-skill{
            display: inline-block;
            height: 28px;
            background: none;
            background-color: lightskyblue;
            color: white;
            border: none;
        }
        #add-skill{
            margin-left: 10px;
            display: inline-block;
            background: none lightskyblue;
            color: white;
            border-radius: 50%;
            outline: none;
            border: none;
        }

        #enroll-class-error-message{
            color: darkred;
            font-size: small;
            margin-bottom: 5%;
        }
        #skill-title{
            font-family: 'Montserrat', sans-serif;
            color: gray;
            margin-top: 10px;
        }
        #info-container{
            word-wrap: break-word;
            width: 700px;
            margin-left: 100px;
        }
        .create-group-modal-content{
            position: absolute;
            background-color: white;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            height: 60%;
            width: 10%;
            margin: 10% auto;
            top:0;
	        bottom: 0;
	        left: 0;
	        right: 0;
            min-width: 850px;
        }
        #create-group-modal-body{
            margin: 5% 5% 5% 5%;
        }
        #create-group-banner{
            width:100%;
            height:30%;
            background-color: lightskyblue;
            text-align: center;
            padding-top: 20px;
        }
        #banner-create-group-text{
            font-family: 'Montserrat', sans-serif;
            color: white;
        }
        #group-name-input{
            width: 60%;
            outline: none;
            border: 2px solid lightskyblue;
            padding-left: 10px;
        }
        #group-name-text{
            font-family: 'Montserrat', sans-serif;
            color: gray;
        }
        #create-group-error-message{
            color: darkred;
            font-size: small;
            margin-bottom: 5%;
        }
        #create-group-button{
            background-color: lightskyblue;
            height: 40px;
            width: 200px;
            color: white;
            border: none;
            margin-top: 10%;
        }
        #unenroll-link{
            color: gray;
            float:right;
            margin-right: 20px;
            margin-top: 20px;
        }
        #skill-text{
            margin-top:-2%;
            color: lightskyblue;
            font-family: 'Montserrat', sans-serif;
        }
        #skills-list-text{
            margin-top:-7px;
        }
        #student-group-name-text{
            font-family: 'Montserrat', sans-serif;
            color: gray;
        }
        #student-group-name{
            color: lightskyblue;
        }
        .invite-button{
            background: none;
            outline: none;
            border: none;
            color: lightskyblue;
            font-family: 'Montserrat', sans-serif;
            margin-bottom: 10px;
        }
        .students-in-group-text{
            color: gray;
            font-family: 'Montserrat', sans-serif;
        }
        #remove-student{
            margin-right: -200px;
            float: right;
            background: none;
            border: none;
            color: darkred;
            outline:none;
            font-size: 20px;
        }
        #remove-group{
            float: right;
            background: none;
            border: none;
            color: darkred;
            outline:none;
            font-size: 20px;
            z-index: 1;
            margin-top:-60px;
        }
        .remove-modal-content{
            position: absolute;
            background-color: white;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            height: 40%;
            width: 30%;
            margin: 20% auto;
            top:0;
	        bottom: 0;
	        left: 0;
	        right: 0;
            min-width: 850px;
            padding-left: 30px;
            padding-right: 30px;
            padding-top: 30px;
            text-align: center;
        }
        #confirm-removal{
            background: none;
            background-color: darkred;
            color: white;
            border: none;
            outline: none;
            height: 50px;
            width: 100px;
            margin-top: 70px;
        }
        #dont-confirm-removal{
            background: none;
            background-color: gray;
            color: white;
            border: none;
            outline: none;
            height: 50px;
            width: 100px;
            margin-top: 70px;
            margin-right: 50px;
        }
        #removal-text{
            color: darkred;
            font-size: 24px;
            font-family: 'Montserrat', sans-serif;
        }
        #enroll-students-link{
            color: gray;
            float:right;
            margin-right: 20px;
            margin-top: 20px;
        }
        #student-search{
            border: 2px solid lightskyblue;
            width: 98%;
            height: 40px;
            outline: none;
            text-indent: 10px;
            margin-bottom: 20px;
            background-color: whitesmoke;
        }
        #group-search{
            border: 2px solid lightskyblue;
            width: 98%;
            height: 40px;
            outline: none;
            text-indent: 10px;
            margin-bottom: 20px;
            background-color: whitesmoke;
        }
        .invite-button-processed-text{
            color: gray;
            font-family: 'Montserrat', sans-serif;
            margin-bottom: 10px;
        }
        .row{
            display: flex;
        }
        #group-list{
            margin-left: 5%;
        }

        .message-font {
            font-family: Arial,"Helvetica Neue",Helvetica,sans-serif;
        }
        .whole-message {
            margin-bottom: 2em;
            word-wrap: break-word;
        }
        .span-parent-content {
            white-space: pre-line;
        }

        .message-info {
            float: right;
            clear: right;
        }
        .key-info {
            font-size: 0.7em;
            color: dodgerblue;
        }
        .comment-delete-button:hover{
            cursor: pointer;
        }
        .value-info {
            font-size: 0.8em;
            color: skyblue;
        }
        .message-date {
            color: black;
        }
        .child-separator {
            color: lightgray;
            opacity: 0.4;
        }
        #add-a-comment {
            color: #848d95;
            margin-left: 2em;
        }
        #add-a-comment:hover {
            text-decoration: underline;
            cursor: pointer;
        }
        .child-message {
            margin-top: 1em;
            margin-left: 2em;
        }
        .parent-message {
            background-color: lightgray;
            font-size: 1.2em;
            overflow: auto;
            padding-left: 10px;
            padding-right: 5px;
        }
        #new-topic-button{
            outline: none;
            background-color: whitesmoke;
            border: none;
            color: dodgerblue;
            font-size: 24px;
            margin-bottom: 10px;

        }
        .cancel-post-button{
            margin-left: 2em;
            color: darkred;
        }
        .cancel-post-button:hover{
            color: darkred;
            text-decoration: underline;
        }
        .post-text-box{
            background-color: whitesmoke;
        }
        #assignments-roster{
            margin-bottom: 20px;
        }
        #cant-view-assignments-text{
            color: gray;
            font-size: 30px;
            font-family: 'Montserrat', sans-serif;
        }
        .delete-assignment{
            border: none;
            color: red;
            outline: none;
            background: none;
        }

        .bootstrap-datetimepicker-widget.dropdown-menu {
            width: 240px;
        }

    </style>
{% if messages %}
        <script>
            {% for msg in messages %}
                alert('{{ msg.message }}');
            {% endfor %}
        </script>
{% endif %}
    {% if invalid %}
        <p style="margin-left: 300px; margin-top: 80px; position:absolute">This class does not exist.</p>
    {% else %}
        <div id="wrapper">
            <div id="banner-card">
                <h1 id = "class-title">{{class.class_name}}</h1>
                {% if enrolled %}
                    <a id="unenroll-link" href="/groups/class/unenroll/{{ class.class_id }}">Unenroll from class</a>
                {% elif request.user.pk == class.instructor_instance.account_id %}
                    <a id="enroll-students-link" href="enrollstudents/{{ class.class_id }}">Enroll students into your class</a>
                {% endif %}
                <a id="instructor-name" href="/account/{{ class.instructor_instance.account_id }}">{{ class.instructor_instance.first_name }} {{ class.instructor_instance.last_name }}</a>
                <br>
                <hr id="underline" style="width:50px;border:5px solid lightskyblue" class="w3-round">
                <br>
            </div>
            {% if not enrolled and user.account_id != class.instructor_instance_id and not user.is_instructor%}
                <button id="enroll-class-container">
                    <h1 id="enroll-class-text">Enroll in Class</h1>
                </button>
                <div id="enroll-modal" class="modal">
                    <div class="enroll-modal-content">
                        <div id="enroll-class-banner">
                            <h3 id="banner-enroll-class-text">Enroll in {{ class.class_name }}</h3>
                        </div>
                        <div id="enroll-modal-body">
                            <textarea placeholder="Give a description about yourself!" id="enroll-class-description"></textarea>
                            <p id="skill-title">What skills do you have that are relevant to this class?</p>
                            <ul id="skill_list" class="unordered-list"><li id="skill_0" class="list-item">
                                <input class = "skill" name="skill_set_0">
                                <button class="delete-skill" onclick="deleteSkill(this)">X</button>
                                </li><button id="add-skill" onclick="addSkill()">+</button></ul>
                            <button id="enroll-class-button" onclick="enroll()">Enroll</button>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% if enrolled and not in_group or request.user.pk == class.instructor_instance_id %}
                    <button id="create-group-container">
                        <h1 id="create-group-container-text">Start a Group</h1>
                    </button>
                    <div id="create-group-modal" class="modal">
                        <div class="create-group-modal-content">
                            <div id="create-group-banner">
                                <h3 id="banner-create-group-text">Start a Group in {{ class.class_name }}</h3>
                            </div>
                            <div id="create-group-modal-body">
                                <p id="group-name-text">Give your group a name</p>
                                <input id = "group-name-input" name="group-name">
                                <br>
                                <button id="create-group-button" onclick="createGroup()">Create Group</button>
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% if enrolled and not user.is_instructor and in_group%}
                    <button id="big-group-button" onclick="window.location.href='/groups/{{ own_group.group_id }}'">
                        <h1 id="big-group-button-text">Your group is: {{ own_group.group_name }}</h1>
                    </button>
                {% endif %}
            <div style="text-align: center">
                <button id="students-button" onclick="changeToStudentRoster()">Students</button>
                <button id="groups-button" onclick="changeToGroupRoster()">Groups</button>
                <button id="discussion-button" onclick="changeToDiscussionRoster()">Discussion</button>
                <button id="assignments-button" onclick="changeToAssignmentsRoster()">Assignments</button>
            </div>

            <div id="student-roster">
                <input type="text" id="student-search" onkeyup="studentSearch()" placeholder="Search for Students">
                {% for k,v in student_descriptions_skills.items %}
                    <div class="student-container" id="{{ k.student_instance.account_id }}">
                        {% if k.student_instance.profile_photo %}
                            <img class="profile-photo" src="{{ k.student_instance.profile_photo.url }}"/>
                        {% else %}
                            <img class="profile-photo" src="../../media/default.jpg"/>
                        {% endif %}
                        <div id="info-container">
                            {% if request.user.pk == class.instructor_instance.pk %}
                                <button onclick="removeStudentModal(this)" id="remove-student">X</button>
                            {% endif %}
                            <a class="student-name" href="/account/{{ k.student_instance.account_id }}">{{ k.student_instance.first_name }} {{ k.student_instance.last_name }}</a>
                            <p id="description">{{ v.description }}</p>
                            <br>
                            <div id="skills">
                                <p id="skill-text">Skills:</p>
                                <p id="skills-list-text" class="skill-item">{{ v.skills }}</p>
                            </div>
                            <p class='email' style="display:none;">{{ k.student_instance.email }}</p>
                            <br>
                            {% if "group" in v %}
                                <p id="student-group-name-text">This student is in the following group: <a href="/groups/{{ v.group.group_id }}" id="student-group-name">{{ v.group.group_name }}</a></p>
                            {% elif in_group and k.student_instance.account_id != request.user.account_id %}
                                {% if v.pending %}
                                    <p class="invite-button-processed-text">You have invited this student to your group</p>
                                {% elif v.accepted %}
                                    <p class="invite-button-processed-text">This student is already in your group</p>
                                 {% else %}
                                    <button class="invite-button" id="button-{{ k.student_instance.account_id }}" onclick="inviteStudent(this)">+ Invite student to your group</button>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
            {% if isInstructor %}
                <div id="assignments-roster">
                    <button onclick="publish()" id="assignment-container">
                        <h1 id="assignment-container-text">+ Publish New Assignment</h1>
                    </button>
                <div id="publish-form-container" style="display: none">
                <form method="post" enctype="multipart/form-data" id="publish-form">
                    {% csrf_token %}
                    {{ form.errors }}
                    <ul id="form-ul-container">
                        <li id="form-li-container"><p id="group-name-text">Subject</p><div style="width: 60%">{{ form.subject }}</div></li>
                        <li id="form-li-container"><p id="group-name-text">File</p><div style="width: 60%">{{ form.file }}</div></li>
                        <li id="form-li-container"><p id="group-name-text">Description</p><div style="width: 60%">{{ form.description }}</div></li>
                        <li id="form-li-container"><p id="group-name-text">Deadline</p><div style="width: 60%">{{ form.due_date }}</div></li>
                        <li id="form-li-container" style="display: none">{{ form.class_instance }}</li>
                        <li id="form-li-container">
                        <div style="width: 60%">
                            <button id="create-group-button" type="submit">submit</button>
                            <button id="create-group-button" type="button" onclick="cancel_form()">cancel</button>
                        </div>
                        </li>
                    </ul>
                </form>
                </div>
                    <table class="assignment">
                        <thead>
                            <tr>
                                <th class="assignment">Assignment Subject (click name to view detail) </th>
                                <th class="assignment">due Date</th>
                                <th class="assignment">Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for assignment in assignments %}
                                <tr>
                                    <td class="assignment">
                                        <a style="color: dodgerblue" href="../../assignment/detail/{{ assignment.assignment_id }}"> {{ assignment.subject }} </a>
                                    </td>
                                    <td class="assignment">
                                        <span> {{ assignment.due_date }} </span>
                                    </td>
                                    <td class="assignment">
                                        <button onclick="removeAssignmentModal({{ assignment.assignment_id }})" class="delete-assignment">X</button>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% elif enrolled %}
            <div id="assignments-roster">
                <table>
                <thead>
                    <tr>
                        <th class="assignment">Subject</th>
                        <th class="assignment"></th>
                        <th class="assignment">Deadline</th>
                        <th class="assignment">Status</th>
                        <th class="assignment">Upload Time</th>
                        <th class="assignment"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for key, value in assignment_rel_dic.items %}
                        <tr>
                            <td>
                                {% if key.file %}
                                    <a style="color: dodgerblue" href="{{ key.file.url }}">{{ key.subject }}</a>
                                {% else %}
                                    <span>{{ key.subject }}</span>
                                {% endif %}
                            </td>
                            <td>
                             <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#exampleModal_{{ forloop.counter }}">
                                    details
                             </button>
                                <div class="modal fade" id="exampleModal_{{ forloop.counter }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                  <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Description</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">&times;</span>
                                        </button>
                                      </div>
                                      <div class="modal-body">
                                        {{ key.description }}
                                      </div>
                                      <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                            </td>
                            <td>
                                {% if time_now < key.due_date  %}
                                    <span>{{ key.due_date }}</span>
                                {% else %}
                                    <span style="color:red;">{{ key.due_date }}</span>
                                {% endif %}
                            </td>
                            {% if value %}
                                <td>
                                    <span> <a class="btn btn-success btn-sm" href="{{ value.student_upload_instance.upload_file.url }}" title="{{ value.student_upload_instance.description }}">submitted, click to download</a> </span>
                                </td>
                                <td>

                                    <span>{{ value.upload_time }}</span>
                                </td>
                                <td>
                                    <a class="btn btn-danger btn-sm" href="../../../assignment/student/upload/group/{{own_group.group_id}}/assignment/{{key.assignment_id}}"> Resubmit </a>
                                </td>
                            {% else %}
                            <td>
                                <span> No upload files </span>
                            </td>
                            <td>

                            </td>
                            <td>
                                {% if in_group %}
                                    <a class="btn btn-primary btn-sm" href="../../../assignment/student/upload/group/{{own_group.group_id}}/assignment/{{key.assignment_id}}"> Submit Now </a>
                                {% else %}
                                    <p>You must be in a group in order to submit an assignment.</p>
                                {% endif %}
                            </td>
                        {% endif %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
            {% else %}
                <div id="assignments-roster">
                    <p id="cant-view-assignments-text">You must be enrolled in this class in order to view the assignments.</p>
                </div>
            {% endif %}
            <div id="discussion-roster">
                {% if enrolled or isInstructor %}
                    <div id="message-board" class="has-border">
                        <div id="create-new-message-area">
                            <button id="new-topic-button" onclick="create_form(this, -5)">+ Start New Topic</button>
                        </div>
                        {% for key, values in msg_dict.items %}
                            <div class="has-border message-font whole-message">
                                <div class="parent-message">
                                    <span class="span-parent-content">{{ key.body }}</span>
                                    <span class="message-info">
                                    <a href="../../account/{{ key.creator.account_id }}" class="key-info">{{ key.creator.first_name }}</a>
                                    <i class="key-info message-date">{{ key.date }}</i>
                                    {% if requesterID == key.creator.account_id or isInstructor %}
                                        <a onclick="removeCommentModal({{ key.message_id }})" class="key-info comment-delete-button" style="color: dodgerblue">delete</a>

                                    {% endif %}
                                    </span>
                                </div>

                                <div class="child-message">
                                    {% for val in values %}
                                        <div>
                                            {{ val.body }} -
                                            <a href="../../account/{{ val.creator.account_id }}" class="value-info">{{ val.creator.first_name }}</a>
                                            <i class="value-info message-date">{{ val.date }}</i>
                                            {% if requesterID == val.creator.account_id or isInstructor %}
                                                <a onclick="removeCommentModal({{ val.message_id }})" class="value-info comment-delete-button" style="color: skyblue">delete</a>
                                            {% endif %}
                                        </div>
                                        <hr class="child-separator">
                                    {% endfor %}
                                    <a onclick="create_form(this, {{ key.message_id }})" id="add-a-comment">add a comment</a>
                                </div>
                                <hr>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

        <div id="remove-modal" class="modal">
            <div id="remove-modal-body" class="remove-modal-content">
                <button id="dont-confirm-removal">No</button>
                <button id="confirm-removal" onclick="remove()">Yes</button>
            </div>
        </div>
            <div id="group-roster">
                <input type="text" id="group-search" onkeyup="groupSearch()" placeholder="Search for Groups">
                <div id="group-list">
                {% for k,v in groups.items %}
                    {% if forloop.counter0|divisibleby:2 %}<div class="row">{% endif %}
                    <div class="group-container column" id="group-{{ k.group_id }}">
                        {% if request.user.pk == class.instructor_instance.pk %}
                            <button onclick="removeStudentModal(this)" id="remove-group">X</button>
                        {% endif %}
                        <a href="/groups/{{ k.group_id }}" class="group-name">{{ k.group_name }}</a>
                        <p class="students-in-group-text">{{ v }}</p>
                    </div>
                    {% if forloop.counter|divisibleby:2 %}</div>{% endif %}
                {% endfor %}
                </div>
            </div>
        </div>

    {% endif %}
    <script>

        function create_form(this_element, pid) {
            console.log("create form")
            $(".post_form").remove();
            let container, body, buttonElement, cancel;
            parent = this_element.parentElement;

            container = document.createElement('div');
            container.setAttribute('class', "post_form");
            container.style.marginBottom = "2em";

            body = document.createElement('textarea'); //input element, text
            body.setAttribute('type',"text");
            body.setAttribute('id',"reply_"+pid);
            body.style.width = "100%";
            body.style.className = "post-text-box";
            body.onkeydown = function(event) {
                var shiftKey = event.shiftKey;

                if (shiftKey && event.key === 'Enter') {
                    create_post(pid, body.id);
                }
                if (event.key === 'Escape' || event.key === 'Esc') {
                    cancel_post(this);
                }
            };

            buttonElement = document.createElement('a');
            buttonElement.innerHTML = "post";
            buttonElement.href = "";
            buttonElement.style.color = "lightskyblue";
            buttonElement.onclick = function () { create_post(pid, body.id) };
            cancel = document.createElement('a');
            cancel.innerHTML = "cancel";
            cancel.className = 'cancel-post-button';
            cancel.href = "";
            cancel.onclick = function () { cancel_post(this) };

            container.appendChild(body);
            container.appendChild(document.createElement('br'));
            container.appendChild(buttonElement);
            container.appendChild(cancel);

            parent.appendChild(container);
        }

        function create_post(parent_id,body_id){
            var bodyElement = document.getElementById(body_id);
            var body = bodyElement.value;
            if (body === "") {
                return ;
            }
            console.log(parent_id, body_id);
                $.ajax({
                        url: '/discussion/create_class_post/',
                        method: 'post',
                        data: {
                            'csrfmiddlewaretoken': '{{ csrf_token }}',
                            'body': body,
                            'class_id': '{{ class.class_id }}',
                            'parent_id': parent_id
                        },
                        dataType: 'json',
                        success: function (data) {
                            if(data["result"]){
                                window.location.href = "";
                            }
                            else {
                                alert("fail to reply");
                            }
                        },
                        error: function (data){
                        }
                      });
            }

        function delete_post(post_id){
            $.ajax({
                    url: '/discussion/delete/',
                    method: 'post',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'post_id': post_id
                    },
                    dataType: 'json',
                    success: function (data) {
                        if(data["result"]){
                            window.location.href = "";
                        }
                        else {
                            alert("fail to delete");
                        }
                    },
                    error: function (data){
                    }
                  });
        }

        function cancel_post(element) {
            let parent = element.parentElement;
            let grand = parent.parentElement;
            grand.removeChild(parent);
        }

        window.onbeforeunload = function () {
        var scrollPos;   
        if (typeof window.pageYOffset != 'undefined') {
           scrollPos = window.pageYOffset;
        }
        else if (typeof document.compatMode != 'undefined' &&
             document.compatMode !== 'BackCompat') {
           scrollPos = document.documentElement.scrollTop;
        }
        else if (typeof document.body != 'undefined') {
           scrollPos = document.body.scrollTop;
        }
        document.cookie="scrollTop="+scrollPos;
    };
        document.onreadystatechange = function(e)
        {
            if (document.readyState === 'complete')
            {
                if(document.cookie.match(/show=([a-zA-Z]+)/)!=null){
                    var showElement = document.cookie.match(/show=([a-zA-Z]+)/);
                    {#console.log(showElement[1]);#}
                    if (showElement[1] === "student") {
                        changeToStudentRoster();
                    } else if (showElement[1] === "group") {
                        changeToGroupRoster();
                    } else if (showElement[1] === "discussion") {
                        changeToDiscussionRoster();
                        if(document.cookie.match(/scrollTop=([^;]+)(;|$)/)!=null){
                            var arr=document.cookie.match(/scrollTop=([^;]+)(;|$)/);
                            document.documentElement.scrollTop=parseInt(arr[1]);
                            document.body.scrollTop=parseInt(arr[1]);
                        }
                    }
                    else if (showElement[1] === "assignments") {
                        changeToAssignmentsRoster();
                    }
                } else {
                    changeToStudentRoster();
                }
            }
        };

        function changeToStudentRoster(){
            document.getElementById("groups-button").setAttribute("style", 'color:gray');
            document.getElementById("students-button").setAttribute("style", 'color:lightskyblue');
            document.getElementById("assignments-button").setAttribute("style", 'color:gray');
            document.getElementById("discussion-button").setAttribute("style", 'color:gray');
            document.getElementById("student-roster").style.display = "block";
            document.getElementById("group-roster").style.display = "none";
            document.getElementById("discussion-roster").style.display = "none";
            document.getElementById("assignments-roster").style.display="none";
            document.cookie = "show="+"student";
        }
        function changeToGroupRoster(){
            document.getElementById("students-button").setAttribute("style", 'color:gray');
            document.getElementById("groups-button").setAttribute("style", 'color:lightskyblue');
            document.getElementById("assignments-button").setAttribute("style", 'color:gray');
            document.getElementById("discussion-button").setAttribute("style", 'color:gray');
            document.getElementById("student-roster").style.display = "none";
            document.getElementById("group-roster").style.display = "block";
            document.getElementById("discussion-roster").style.display = "none";
            document.getElementById("assignments-roster").style.display="none";
            document.cookie = "show="+"group";
        }
        function changeToDiscussionRoster() {
            document.getElementById("students-button").setAttribute("style", 'color:gray');
            document.getElementById("groups-button").setAttribute("style", 'color:gray');
            document.getElementById("assignments-button").setAttribute("style", 'color:gray');
            document.getElementById("discussion-button").setAttribute("style", 'color:lightskyblue');
            document.getElementById("student-roster").style.display = "none";
            document.getElementById("group-roster").style.display = "none";
            document.getElementById("assignments-roster").style.display="none";
            document.getElementById("discussion-roster").style.display = "block";
            document.cookie = "show="+"discussion";
        }
        function changeToAssignmentsRoster() {
            document.getElementById("students-button").setAttribute("style", 'color:gray');
            document.getElementById("groups-button").setAttribute("style", 'color:gray');
            document.getElementById("discussion-button").setAttribute("style", 'color:gray');
            document.getElementById("assignments-button").setAttribute("style", 'color:lightskyblue');
            document.getElementById("student-roster").style.display = "none";
            document.getElementById("group-roster").style.display = "none";
            document.getElementById("discussion-roster").style.display = "none";
            document.getElementById("assignments-roster").style.display = "block";
            document.cookie = "show="+"assignments";
        }

        var enrollModal = document.getElementById("enroll-modal");
        var enrollButton = document.getElementById("enroll-class-container");
        //var span = document.getElementsByClassName("close")[0];
        let enrollModalBody = document.getElementById("enroll-modal-body");
        let enroll_message_error_displayed = false;

        var createGroupModal = document.getElementById("create-group-modal");
        var createGroupButton = document.getElementById("create-group-container");
        //var span = document.getElementsByClassName("close")[0];
        let createGroupModalBody = document.getElementById("create-group-modal-body");
        let create_group_message_error_displayed = false;

        function createGroup(){
            let groupName = document.getElementById("group-name-input").value;
            if((!groupName.replace(/\s/g, '').length || groupName.length > 50) && !create_group_message_error_displayed){
                let p = document.createElement('p');
                p.setAttribute("id", "create-group-error-message");
                p.innerHTML = "You must provide a valid group name. Please make sure you haven't exceeded the maximum character limit of 50";
                createGroupModalBody.prepend(p);
                create_group_message_error_displayed = true;
            }
            else if (groupName.replace(/\s/g, '').length && groupName.length <= 50){
                console.log(groupName);
                $.ajax({
                    url: '/groups/class/creategroup/{{ class.class_id }}',
                    method: 'post',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'group_name': groupName,
                        'class_id': '{{ class.class_id }}'
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log("/groups/" + data);
                        window.location.href = "/groups/" + data["group_id"];
                    },
                    error: function (data){
                    }
                  });

            }
        }

        function enroll(){
            let description = document.getElementById("enroll-class-description").value;
            let iter = document.getElementsByClassName("skill");
            let skills = [];
            for(var i = 0; i < iter.length; i++){
                var skill = iter[i].value;
                if(skill != null){
                    if (skill.length>0 && skill.replace(/\s/g, '').length){
                        skills.push(skill)
                    }
                }
            }
            if((skills.length === 0 || !description.replace(/\s/g, '').length) && !enroll_message_error_displayed){
                let p = document.createElement('p');
                p.setAttribute("id", "enroll-class-error-message");
                p.innerHTML = "You must provide a valid description and at least one skill.";
                enrollModalBody.prepend(p);
                enroll_message_error_displayed = true;
            }
            else if (skills.length !== 0 && description.replace(/\s/g, '').length){
                $.ajax({
                    url: '/groups/class/enroll/{{ class.class_id }}',
                    method: 'post',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'description': description,
                        'skills': skills,
                        'class_id': '{{ class.class_id }}'
                    },
                    dataType: 'json',
                    success: function (data) {
                        window.location.href="/groups/class/{{ class.class_id }}"
                    },
                    error: function (data){
                    }
                  });
            }
        }

        {% if not enrolled and request.user.pk != class.instructor_instance.account_id %}
            enrollButton.onclick = function() {
              enrollModal.style.display = "block";
            };
        {% endif %}

        {% if enrolled and not in_group or request.user.pk == class.instructor_instance.account_id %}
            createGroupButton.onclick = function(){
              createGroupModal.style.display="block";
            };
        {% endif %}

        window.onclick = function(event) {
          if (event.target == enrollModal) {
              if(enroll_message_error_displayed) {
                  enrollModalBody.removeChild(document.getElementById("enroll-class-error-message"));
                  enroll_message_error_displayed = false;
                }
              enrollModal.style.display = "none";
          }
          if (event.target == createGroupModal) {
              if(create_group_message_error_displayed) {
                  createGroupModalBody.removeChild(document.getElementById("create-group-error-message"));
                  create_group_message_error_displayed = false;
                }
              createGroupModal.style.display = "none";
          }
          if(event.target == removeModal){
              removeModal.removeChild(document.getElementById("removal-text"));
              removeModal.style.display = "none";
          }
        };

        var skill_num = 1;
        function addSkill(){
            let ul, li;
            ul = document.getElementById("skill_list");
            ul.setAttribute("class", "unordered-list");
            console.log("skill_" + (skill_num-1));
            li = document.createElement('li');
            li.setAttribute("class", "list-item");
            li.id = "skill_" + skill_num;
            li.class = "skill";
            li.innerHTML = "<input class='skill' name='skill_set_" + skill_num + "'> <button class=\"delete-skill\" onclick=\"deleteSkill(this)\">X</div>";
            ul.insertBefore(li, ul.childNodes[ul.childNodes.length-1])
            skill_num++;
            if (ul.childNodes.length > 9){
                document.getElementById("add-skill").style.display = "none"
            }
        }
        function deleteSkill(elem){
            let ul, id;
            id = elem.parentElement.id;
            ul = document.getElementById("skill_list");
            ul.removeChild(document.getElementById(id));
            if(ul.childNodes.length <= 9){
                document.getElementById("add-skill").style.display = "inline-block"
            }

        }

        let studentToRemove = null;
        let groupToRemove = null;
        var removingStudent = false;
        let id = null;
        let parentElement = null;
        removeModal = document.getElementById("remove-modal");
        removeModalBody = document.getElementById("remove-modal-body");
        noButton = document.getElementById("dont-confirm-removal");
        yesButton = document.getElementById("confirm-removal");

        noButton.onclick = function() {
            removeModalBody.removeChild(document.getElementById("removal-text"));
            removeModal.style.display = "none";
        };

        var removeComment = false;
        var commentId = null;
        function removeCommentModal(comment_id) {
            removeComment = true;
            commentId = comment_id;
            let p = document.createElement('p');
            p.setAttribute("id", "removal-text");
            p.innerHTML = "Are you sure you want to delete this message and any comment messages that may be associated with it?";
            removeModalBody.prepend(p);
            removeModal.style.display="block";
        }

        var removeAssignment = false;
        var assignmentId = null;
        function removeAssignmentModal(assignment_id){
            removeAssignment = true;
            assignmentId = assignment_id;
            let p = document.createElement('p');
            p.setAttribute("id", "removal-text");
            p.innerHTML = "Are you sure you want to delete this assignment? Doing so will also delete any submissions.";
            removeModalBody.prepend(p);
            removeModal.style.display="block";
        }

        function removeStudentModal(elem){
            let parent = elem.parentElement;
            parentElement = parent;
            if(parent.id === "info-container"){
                parent = parent.parentElement;
            }
            console.log(parent);
            if(parent.className === "student-container"){
                id = parent.id;
                removingStudent = true;
                let p = document.createElement('p');
                p.setAttribute("id", "removal-text");
                p.innerHTML = "Are you sure you want to remove this student from your class?";
                removeModalBody.prepend(p);
            }
            else{
                id = parent.id;
                removingStudent = false;
                let p = document.createElement('p');
                p.setAttribute("id", "removal-text");
                p.innerHTML = "Are you sure you want to delete this group? Doing this will remove all students from the group.";
                removeModalBody.prepend(p);
            }
            console.log(removeModal);
            removeModal.style.display="block";
        }

        function remove(){
            if(removeComment) {
                delete_post(commentId);
            }
            else if(removeAssignment){
                deleteAssignment(assignmentId);
            }
            else if(removingStudent){
                $.ajax({
                    url: '/groups/class/removestudent/',
                    method: 'post',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'student_id': id,
                        'class_id': '{{ class.class_id }}'
                    },
                    dataType: 'json',
                    success: function (data) {
                        removeModalBody.removeChild(document.getElementById("removal-text"));
                        parentElement.parentElement.style.display = "none";
                        removeModal.style.display = "none";
                        console.log(data);
                        if("was_in_group" in data){
                            var gc = document.getElementById("group-" + data["group_id"]);
                            var studentsInGroup = gc.getElementsByClassName("students-in-group-text")[0];
                            studentsInGroup.innerText = data["remaining_students"];
                        }
                    },
                    error: function (data){
                    }
                  });
            }
            else{
                id = id.split("-");
                id = id[id.length-1];
                $.ajax({
                    url: '/groups/class/removegroup/',
                    method: 'post',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'group_id': id,
                        'class_id': '{{ class.class_id }}'
                    },
                    dataType: 'json',
                    success: function (data) {
                        removeModalBody.removeChild(document.getElementById("removal-text"));
                        parentElement.style.display = "none";
                        removeModal.style.display = "none";
                    },
                    error: function (data){
                    }
                  });
            }
        }
        function studentSearch(){
            // Declare variables
          var input, filter, studentContainers, sc, a, i, b, c, txtValue, txtValue2, txtValue3;
          input = document.getElementById('student-search');
          filter = input.value.toUpperCase();
          sc = document.getElementsByClassName("student-container");
          // Loop through all list items, and hide those who don't match the search query
          for (i = 0; i < sc.length; i++) {
            a = sc[i].getElementsByClassName("email")[0];
            b = sc[i].getElementsByClassName("student-name")[0];
            c = sc[i].getElementsByClassName("skill-item")[0];
            txtValue = a.textContent || a.innerText;
            txtValue2 = b.textContent || b.innerText;
            txtValue3 = c.textContent || c.textContent;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                sc[i].style.display = "";
            }
            else if(txtValue2.toUpperCase().indexOf(filter) > -1){
                sc[i].style.display = "";
            }
            else if(txtValue3.toUpperCase().indexOf(filter) > -1){
                sc[i].style.display = "";
            }
            else {
                sc[i].style.display = "none";
            }
          }
        }
        function groupSearch(){
            // Declare variables
          var input, filter, studentContainers, sc, a, i, b, txtValue, txtValue2;
          input = document.getElementById('group-search');
          filter = input.value.toUpperCase();
          sc = document.getElementsByClassName("group-container");
          // Loop through all list items, and hide those who don't match the search query
          for (i = 0; i < sc.length; i++) {
            a = sc[i].getElementsByClassName("group-name")[0];
            b = sc[i].getElementsByClassName("students-in-group-text")[0];
            txtValue = a.textContent || a.innerText;
            txtValue2 = b.textContent || b.innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
              sc[i].style.display = "";
            }
            else if(txtValue2.toUpperCase().indexOf(filter) > -1){
                sc[i].style.display = "";
            }
            else {
              sc[i].style.display = "none";
            }
          }
        }

        function inviteStudent(elem){
            var buttonId = elem.id;
            var list = buttonId.split("-");
            var studentId = list[list.length - 1];
            $.ajax({
                url: '/groups/invite/',
                method: 'post',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'student_id': studentId,
                    'class_id': '{{ class.class_id }}'
                },
                dataType: 'json',
                success: function (data) {
                    var parent = elem.parentElement;
                    parent.removeChild(elem);
                    let p = document.createElement('p');
                    p.setAttribute("class", "invite-button-processed-text");
                    p.innerHTML = "You have invited this student to your group.";
                    parent.appendChild(p)
                },
                error: function (data){
                }
              });
        }


        function publish() {
            var type = document.getElementById("publish-form-container").style.display;
            if (type === "none") {
                document.getElementById("publish-form-container").style.display = "block";
            } else {
                document.getElementById("publish-form-container").style.display = "none";
            }
        }
        function cancel_form() {
            window.location.href = ""
        }
        function deleteAssignment(assignment_id){
             $.ajax({
                    url: '/assignment/removeassignment/',
                    method: 'post',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'assignment_id': assignment_id,
                    },
                    dataType: 'json',
                    success: function (data) {
                        window.location.href = ""
                    },
                    error: function (data){
                    }
                  });
        }
    </script>
{%endblock %}